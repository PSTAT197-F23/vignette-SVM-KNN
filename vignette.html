<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Lu Liu, Haoran Yan, Shuai Yuan, Irena Wong, and Molata Fu">
<meta name="dcterms.date" content="2023-12-10">

<title>Vignette: Heart Attack Prediction</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="vignette_files/libs/clipboard/clipboard.min.js"></script>
<script src="vignette_files/libs/quarto-html/quarto.js"></script>
<script src="vignette_files/libs/quarto-html/popper.min.js"></script>
<script src="vignette_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="vignette_files/libs/quarto-html/anchor.min.js"></script>
<link href="vignette_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="vignette_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="vignette_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="vignette_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="vignette_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Vignette: Heart Attack Prediction</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Lu Liu, Haoran Yan, Shuai Yuan, Irena Wong, and Molata Fu </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 10, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="predictive-modeling-for-heart-disease" class="level2">
<h2 class="anchored" data-anchor-id="predictive-modeling-for-heart-disease">Predictive Modeling for Heart Disease</h2>
<p>The research aims to develop accurate and efficient models to aid in early detection and intervention strategies for improved patient outcomes.</p>
<p>The predictive models, <strong>XGBoost</strong> and <strong>Support Vector Machine (SVM)</strong>, were selected for their capabilities in handling complex dataset and their potential in accurately identifying heart disease.</p>
<div class="cell" data-hash="vignette_cache/html/unnamed-chunk-1_2c07c28ae949e61d2fc49496b6b88439">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Load neccessary libraries and the dataset</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xgboost)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rsample)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">"C:/Users/molat/OneDrive/Documents/GitHub/vignette-binary-logistic-regression"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"data/heart.rda"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="xgboost-model" class="level2">
<h2 class="anchored" data-anchor-id="xgboost-model">XGBoost Model</h2>
<div class="cell" data-hash="vignette_cache/html/unnamed-chunk-2_92cce030839c30e084c7fa3bbecd1757">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>heart<span class="sc">$</span>cp <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(heart<span class="sc">$</span>cp)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>heart<span class="sc">$</span>fbs <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(heart<span class="sc">$</span>fbs)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>heart<span class="sc">$</span>restecg <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(heart<span class="sc">$</span>restecg)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>heart<span class="sc">$</span>exng <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(heart<span class="sc">$</span>exng)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>heart<span class="sc">$</span>caa <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(heart<span class="sc">$</span>caa)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>heart<span class="sc">$</span>thall <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(heart<span class="sc">$</span>thall)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>heart<span class="sc">$</span>sex <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(heart<span class="sc">$</span>sex)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>heart<span class="sc">$</span>slp <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(heart<span class="sc">$</span>slp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>XGBoost require numerical input for modeling. Converting categorical variables to factors ensures that these variables are encoded as numerical values that the algorithm can process.</p>
<p><strong><em>Splitting the Data into Training and Testing Sets:</em></strong></p>
<div class="cell" data-hash="vignette_cache/html/unnamed-chunk-3_5435ef1f59de3f2c9b333ed28127f503">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">3435</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>heart_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(heart, <span class="at">strata =</span> output, <span class="at">prop =</span> <span class="fl">0.8</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>heart_train <span class="ot">&lt;-</span> <span class="fu">training</span>(heart_split)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>heart_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(heart_split)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>train_x <span class="ot">&lt;-</span> <span class="fu">data.matrix</span>(heart_train[, <span class="sc">-</span><span class="dv">14</span>])</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>train_y <span class="ot">&lt;-</span> heart_train[,<span class="dv">14</span>]</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>test_x <span class="ot">=</span> <span class="fu">data.matrix</span>(heart_test[, <span class="sc">-</span><span class="dv">14</span>])</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>test_y <span class="ot">=</span> heart_test[, <span class="dv">14</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using initial_split() from the rsample package to divide the dataset into training (80%) and testing (20%) sets. This ensures a balanced distribution of classes (stratified by the output variable). Partition of the data is performed randomly, so for reproduction purposes, we need to set seed for this process where set.seed() needs to be executed with the splitting code at the same time.</p>
<p>We also separate the labels and the features to be used in the prediction task in a later stage.</p>
<p><strong><em>Converting Train and Test into xgb.DMatrix Format:</em></strong></p>
<div class="cell" data-hash="vignette_cache/html/unnamed-chunk-4_bb1129718435e1069692eb86ac724933">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>xgb_train <span class="ot">=</span> <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> train_x, <span class="at">label =</span> train_y)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>xgb_test <span class="ot">=</span> <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> test_x, <span class="at">label =</span> test_y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>XGBoost package allows us to group the data into a Dmatrix which can be directly inputted into the training process.</p>
<p><strong><em>Using Cross-Validation to Find Optimal Number of Iterations:</em></strong></p>
<div class="cell" data-hash="vignette_cache/html/unnamed-chunk-5_05fe4f02830ef8c50224fc26b52d9fdb">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>param_list <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">booster =</span> <span class="st">'gbtree'</span>,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">objective =</span> <span class="st">"binary:logistic"</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">eta =</span> <span class="fl">0.01</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">gamma =</span> <span class="dv">1</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_depth =</span> <span class="dv">6</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">subsample =</span> <span class="fl">0.8</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">colsample_bytree =</span> <span class="fl">0.5</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>xgbcv <span class="ot">=</span> <span class="fu">xgb.cv</span>(<span class="at">params =</span> param_list,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> xgb_train,</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">nrounds =</span> <span class="dv">500</span>,</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">nfold =</span> <span class="dv">5</span>,</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>               <span class="at">print_every_n =</span> <span class="dv">10</span>,</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>               <span class="at">early_stopping_rounds =</span> <span class="dv">30</span>,</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>               <span class="at">maximize =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] train-logloss:0.688564+0.000426 test-logloss:0.689515+0.000561 
Multiple eval metrics are present. Will use test_logloss for early stopping.
Will train until test_logloss hasn't improved in 30 rounds.

[11]    train-logloss:0.648138+0.001078 test-logloss:0.658526+0.004514 
[21]    train-logloss:0.610766+0.002526 test-logloss:0.631012+0.006679 
[31]    train-logloss:0.578854+0.003268 test-logloss:0.606494+0.009006 
[41]    train-logloss:0.549389+0.003430 test-logloss:0.586075+0.012526 
[51]    train-logloss:0.522625+0.004828 test-logloss:0.567163+0.013922 
[61]    train-logloss:0.498105+0.005012 test-logloss:0.549929+0.016585 
[71]    train-logloss:0.476419+0.005898 test-logloss:0.535235+0.018305 
[81]    train-logloss:0.456599+0.006501 test-logloss:0.523482+0.021385 
[91]    train-logloss:0.438357+0.007138 test-logloss:0.512039+0.023235 
[101]   train-logloss:0.421719+0.007344 test-logloss:0.502315+0.025389 
[111]   train-logloss:0.406298+0.007288 test-logloss:0.491765+0.027420 
[121]   train-logloss:0.391657+0.007397 test-logloss:0.482773+0.029852 
[131]   train-logloss:0.378376+0.007311 test-logloss:0.474975+0.032544 
[141]   train-logloss:0.365791+0.007221 test-logloss:0.467746+0.034402 
[151]   train-logloss:0.354776+0.007276 test-logloss:0.461383+0.035851 
[161]   train-logloss:0.344038+0.007812 test-logloss:0.456333+0.036779 
[171]   train-logloss:0.333738+0.008243 test-logloss:0.450981+0.037934 
[181]   train-logloss:0.324473+0.008308 test-logloss:0.446279+0.039781 
[191]   train-logloss:0.315785+0.008455 test-logloss:0.441533+0.041116 
[201]   train-logloss:0.307572+0.008816 test-logloss:0.438042+0.041893 
[211]   train-logloss:0.300071+0.008539 test-logloss:0.434093+0.042469 
[221]   train-logloss:0.292937+0.008815 test-logloss:0.430843+0.043856 
[231]   train-logloss:0.286446+0.008670 test-logloss:0.426982+0.045112 
[241]   train-logloss:0.280190+0.008491 test-logloss:0.424449+0.046175 
[251]   train-logloss:0.274173+0.008745 test-logloss:0.422769+0.047761 
[261]   train-logloss:0.268692+0.008867 test-logloss:0.422121+0.049315 
[271]   train-logloss:0.263047+0.008900 test-logloss:0.420513+0.050418 
[281]   train-logloss:0.257830+0.009068 test-logloss:0.418697+0.051613 
[291]   train-logloss:0.252876+0.009051 test-logloss:0.417511+0.052773 
[301]   train-logloss:0.248177+0.009133 test-logloss:0.416981+0.054025 
[311]   train-logloss:0.243779+0.009136 test-logloss:0.416120+0.054782 
[321]   train-logloss:0.239715+0.009434 test-logloss:0.414492+0.055642 
[331]   train-logloss:0.236096+0.009485 test-logloss:0.414123+0.056500 
[341]   train-logloss:0.232629+0.009694 test-logloss:0.413265+0.057653 
[351]   train-logloss:0.229003+0.010415 test-logloss:0.413096+0.058524 
[361]   train-logloss:0.225511+0.010329 test-logloss:0.412857+0.059878 
[371]   train-logloss:0.222205+0.010346 test-logloss:0.413070+0.060805 
[381]   train-logloss:0.219459+0.010446 test-logloss:0.413479+0.062556 
Stopping. Best iteration:
[354]   train-logloss:0.227869+0.010424 test-logloss:0.412709+0.058639</code></pre>
</div>
</div>
<p>The function sgb.cv can take in various parameters, which is explained in the following section:</p>
<p>•<strong>booster</strong>: It specifies the type of booster to use. ‘gbtree’ indicates that the booster is a tree-based model using gradient boosting.</p>
<p>•<strong>objective</strong>: ‘binary:logistic’ implies the selected type of loss function for binary classification, which minimizes the logistic loss for binary outcomes.</p>
<p>•<strong>eta</strong>: It controls the step size shrinkage used in updating weights during the boosting process.</p>
<p>•<strong>gamma</strong>: It represents the minimum loss reduction required to make a further partition on a leaf node of the tree. A higher gamma value leads to a more conservative model by preventing overfitting.</p>
<p>•<strong>max_depth</strong>: This parameter determines the maximum depth of each tree in the boosting process. Higher values allow the model to capture more complex relationships but may lead to overfitting if not controlled properly.</p>
<p>•<strong>subsample</strong>: It defines the fraction of samples to be used for training each tree.</p>
<p>•<strong>colsample_bytree</strong>: This parameter denotes the fraction of features (columns) to be randomly sampled for each tree. A value of 0.5 implies that only 50% of the features will be considered for splitting at each node.</p>
<p>Using xgb.cv() to perform k-fold cross-validation (nfold = 5) on the training data (xgb_train) to determine the optimal number of boosting rounds (nrounds) while avoiding overfitting. Early stopping is implemented (early_stopping_rounds) to halt training if no improvement occurs (when the train loss and test loss does not have significant decrease).</p>
<p><strong>The best iteration is 452 in this case.</strong></p>
<p><strong><em>Using the Best Iteration Round to Perform Model Training:</em></strong></p>
<div class="cell" data-hash="vignette_cache/html/unnamed-chunk-6_06c15033d77ed78a8fb6b7fe7d044ffb">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">3435</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>final.m <span class="ot">=</span> <span class="fu">xgb.train</span>(<span class="at">params =</span> param_list, <span class="at">data =</span> xgb_train, <span class="at">nrounds =</span> <span class="dv">425</span>, <span class="at">verbose =</span> <span class="dv">0</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>var_imp <span class="ot">=</span> <span class="fu">xgb.importance</span>(</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">feature_names =</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(train),</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">c</span>(<span class="st">"output"</span>)),</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> final.m)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>blue_palette <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"lightblue"</span>, <span class="st">"darkblue"</span>))(<span class="fu">length</span>(heart) <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.plot.importance</span>(var_imp, <span class="at">col =</span> blue_palette)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="vignette_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>After training XGBoost model at nrounds = 425, we calculate the importance score for each features and plot it. In XGBoost models, feature importance scores indicate the relative importance of each input feature (or predictor variable) in contributing to the model’s predictive performance. From the importance plot we can see that “cp” which stands for the chest pain type receives the highest importance score.</p>
<p><strong><em>Prediction and Visualization:</em></strong></p>
<div class="cell" data-hash="vignette_cache/html/unnamed-chunk-7_b00ca6737b687cdd48c14fed0a8c1947">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">3435</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(final.m, <span class="at">newdata =</span> test_x)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(predictions <span class="sc">&gt;</span> <span class="fl">0.5</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>conf_matrix <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(<span class="fu">as.factor</span>(predictions), <span class="fu">as.factor</span>(test_y))</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>conf_matrix</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction  0  1
         0 21  4
         1  7 29
                                          
               Accuracy : 0.8197          
                 95% CI : (0.7002, 0.9064)
    No Information Rate : 0.541           
    P-Value [Acc &gt; NIR] : 4.82e-06        
                                          
                  Kappa : 0.6339          
                                          
 Mcnemar's Test P-Value : 0.5465          
                                          
            Sensitivity : 0.7500          
            Specificity : 0.8788          
         Pos Pred Value : 0.8400          
         Neg Pred Value : 0.8056          
             Prevalence : 0.4590          
         Detection Rate : 0.3443          
   Detection Prevalence : 0.4098          
      Balanced Accuracy : 0.8144          
                                          
       'Positive' Class : 0               
                                          </code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>testframe <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(conf_matrix<span class="sc">$</span>table)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>testframe<span class="sc">$</span>Prediction <span class="ot">&lt;-</span> <span class="fu">factor</span>(testframe<span class="sc">$</span>Prediction, <span class="at">levels=</span><span class="fu">rev</span>(<span class="fu">levels</span>(testframe<span class="sc">$</span>Prediction)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Make predictions on the test data. The threshold of 0.5 is applied to convert probabilities to binary predictions, and the model generates a confusion matrix using the predicted values and actual test labels. A confusion matrix allows us to see how many predictions the models make correct or wrong. The function confusionMatrix() also gives us the ensitivity and Specificity automatically. Then, convert the confusion matrix to a data frame for visualizations and rearrange the levels of the Prediction variable to ensure correct plotting order.</p>
<div class="cell" data-hash="vignette_cache/html/unnamed-chunk-8_8fa4dabdf61b51340eb4ae0e0490fb58">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(testframe, <span class="fu">aes</span>(Prediction,Reference, <span class="at">fill=</span> Freq)) <span class="sc">+</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>Freq)) <span class="sc">+</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low=</span><span class="st">"white"</span>, <span class="at">high=</span><span class="st">"#009194"</span>) <span class="sc">+</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Reference"</span>,<span class="at">y =</span> <span class="st">"Prediction"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="vignette_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Finally, plot the confusion matrix to display the frequency of correct and incorrect predictions with gradient colors representing frequency levels.</p>
</section>
<section id="support-vector-machine-svm-model" class="level2">
<h2 class="anchored" data-anchor-id="support-vector-machine-svm-model">Support Vector Machine (SVM) Model</h2>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>